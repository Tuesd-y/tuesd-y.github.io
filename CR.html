<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CR</title>
  <style>
    body { font-family: monospace; padding: 1em; }
    #messages { border: 1px solid #ccc; height: 200px; overflow-y: scroll; margin-bottom: 1em; }
    input, button { margin-right: 0.5em; }
  </style>
</head>
<body>
  <h1>room</h1>

  <div id="messages"></div>

  <input id="username" placeholder="Username" />
  <input id="messageInput" placeholder="Message" />
  <button id="sendBtn">Send</button>

  <script type="module">
    // Import Firebase modular SDK functions
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getDatabase, ref, push, onChildAdded, query, limitToLast } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB2DndEZex118eq4aoj2IfLtVZhoKjIroM",
      authDomain: "tuesd-y.firebaseapp.com",
      databaseURL: "https://tuesd-y-default-rtdb.firebaseio.com",
      projectId: "tuesd-y",
      storageBucket: "tuesd-y.firebasestorage.app",
      messagingSenderId: "662455930846",
      appId: "1:662455930846:web:84820f7b939c7883ae974f",
      measurementId: "G-8WTSYGGMP0"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messagesRef = ref(db, 'messages');

    const messagesDiv = document.getElementById('messages');
    const usernameInput = document.getElementById('username');
    const messageInput = document.getElementById('messageInput');
    const sendBtn = document.getElementById('sendBtn');

    function sendMessage() {
      const user = usernameInput.value.trim();
      const text = messageInput.value.trim();

      if (!user) {
        alert('Please enter a username!');
        return;
      }
      if (!text) {
        alert('Please enter a message!');
        return;
      }

      push(messagesRef, {
        user,
        text,
        timestamp: Date.now()
      }).then(() => {
        messageInput.value = '';
        messageInput.focus();
      }).catch(err => {
        console.error('Error sending message:', err);
      });
    }

    sendBtn.addEventListener('click', sendMessage);

    messageInput.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // Listen for new messages and display them
    const recentMessagesQuery = query(messagesRef, limitToLast(100));

    onChildAdded(recentMessagesQuery, (snapshot) => {
      const msg = snapshot.val();
      const time = new Date(msg.timestamp).toLocaleTimeString();
      const line = `[${time}] <${msg.user}> ${msg.text}`;
      const div = document.createElement('div');
      div.textContent = line;
      messagesDiv.appendChild(div);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });
  </script>
</body>
</html>
